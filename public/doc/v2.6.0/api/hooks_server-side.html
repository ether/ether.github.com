<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Server-side hooks</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_server_side_hooks">Server-side hooks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These hooks are called on server-side.</p>
</div>
<div class="sect2">
<h3 id="_loadsettings">loadSettings</h3>
<div class="paragraph">
<p>Called from: <code>src/node/server.ts</code></p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>settings - the settings object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use this hook to receive the global settings in your plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="_shutdown">shutdown</h3>
<div class="paragraph">
<p>Called from: <code>src/node/server.ts</code></p>
</div>
<div class="paragraph">
<p>Things in context: None</p>
</div>
<div class="paragraph">
<p>This hook runs before shutdown. Use it to stop timers, close sockets and files,
flush buffers, etc. The database is not available while this hook is running.
The shutdown function must not block for long because there is a short timeout
before the process is forcibly terminated.</p>
</div>
<div class="paragraph">
<p>The shutdown function must return a Promise, which must resolve to <code>undefined</code>.
Returning <code>callback(value)</code> will return a Promise that is resolved to <code>value</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// using an async function
exports.shutdown = async (hookName, context) =&gt; {
  await flushBuffers();
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pluginuninstall">pluginUninstall</h3>
<div class="paragraph">
<p>Called from: <code>src/static/js/pluginfw/installer.js</code></p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>plugin_name - self-explanatory</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If this hook returns an error, the callback to the uninstall function gets an error as well. This mostly seems useful for handling additional features added in based on the installation of other plugins, which is pretty cool!</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugininstall">pluginInstall</h3>
<div class="paragraph">
<p>Called from: <code>src/static/js/pluginfw/installer.js</code></p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>plugin_name - self-explanatory</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If this hook returns an error, the callback to the install function gets an error, too. This seems useful for adding in features when a particular plugin is installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_init_plugin_name">init_&lt;plugin name&gt;</h3>
<div class="paragraph">
<p>Called from: <code>src/static/js/pluginfw/plugins.js</code></p>
</div>
<div class="paragraph">
<p>Run during startup after the named plugin is initialized.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logger</code>: An object with the following <code>console</code>-like methods: <code>debug</code>,
<code>info</code>, <code>log</code>, <code>warn</code>, <code>error</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_expresspresession">expressPreSession</h3>
<div class="paragraph">
<p>Called from: <code>src/node/hooks/express.js</code></p>
</div>
<div class="paragraph">
<p>Called during server startup just before the
<a href="https://www.npmjs.com/package/express-session"><code>express-session</code></a> middleware is
added to the Express Application object. Use this hook to add route handlers or
middleware that executes before <code>express-session</code> state is created and
authentication is performed. This is useful for creating public endpoints that
don&#8217;t spam the database with new <code>express-session</code> records or trigger
authentication.</p>
</div>
<div class="paragraph">
<p><strong>WARNING:</strong> All handlers registered during this hook run before the built-in
authentication checks, so any handled endpoints will be public unless the
handler itself authenticates the user.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>app</code>: The Express <a href="https://expressjs.com/en/4x/api.html==app">Application</a>
object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.expressPreSession = async (hookName, {app}) =&gt; {
  app.get('/hello-world', (req, res) =&gt; res.send('hello world'));
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_expressconfigure">expressConfigure</h3>
<div class="paragraph">
<p>Called from: <code>src/node/hooks/express.js</code></p>
</div>
<div class="paragraph">
<p>Called during server startup just after the
<a href="https://www.npmjs.com/package/express-session"><code>express-session</code></a> middleware is
added to the Express Application object. Use this hook to add route handlers or
middleware that executes after <code>express-session</code> state is created and
authentication is performed.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>app</code>: The Express <a href="https://expressjs.com/en/4x/api.html==app">Application</a>
object.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_expresscreateserver">expressCreateServer</h3>
<div class="paragraph">
<p>Called from: <code>src/node/hooks/express.js</code></p>
</div>
<div class="paragraph">
<p>Identical to the <code>expressConfigure</code> hook (the two run in parallel with each
other) except this hook&#8217;s context includes the HTTP Server object.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>app</code>: The Express <a href="https://expressjs.com/en/4x/api.html==app">Application</a>
object.</p>
</li>
<li>
<p><code>server</code>: The <a href="https://nodejs.org/api/http.html==class-httpserver">http.Server</a>
or <a href="https://nodejs.org/api/https.html==class-httpsserver">https.Server</a> object.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_expresscloseserver">expressCloseServer</h3>
<div class="paragraph">
<p>Called from: <code>src/node/hooks/express.js</code></p>
</div>
<div class="paragraph">
<p>Things in context: Nothing</p>
</div>
<div class="paragraph">
<p>This hook is called when the HTTP server is closing, which happens during
shutdown (see the shutdown hook) and when the server restarts (e.g., when a
plugin is installed via the <code>/admin/plugins</code> page). The HTTP server may or may
not already be closed when this hook executes.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.expressCloseServer = async () =&gt; {
  await doSomeCleanup();
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eejsblock_name">eejsBlock_`&lt;name&gt;`</h3>
<div class="paragraph">
<p>Called from: <code>src/node/eejs/index.js</code></p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>content - the content of the block</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook gets called upon the rendering of an ejs template block. For any specific kind of block, you can change how that block gets rendered by modifying the content object passed in.</p>
</div>
<div class="paragraph">
<p>Available blocks in <code>pad.html</code> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>htmlHead</code> - after <code>&lt;html&gt;</code> and immediately before the title tag</p>
</li>
<li>
<p><code>styles</code> - the style `&lt;link&gt;`s</p>
</li>
<li>
<p><code>body</code> - the contents of the body tag</p>
</li>
<li>
<p><code>editbarMenuLeft</code> - the left tool bar (consider using the toolbar controller instead of manually adding html here)</p>
</li>
<li>
<p><code>editbarMenuRight</code> - right tool bar</p>
</li>
<li>
<p><code>afterEditbar</code> - allows you to add stuff immediately after the toolbar</p>
</li>
<li>
<p><code>userlist</code> - the contents of the userlist dropdown</p>
</li>
<li>
<p><code>loading</code> - the initial loading message</p>
</li>
<li>
<p><code>mySettings</code> - the left column of the settings dropdown ("My view"); intended for adding checkboxes only</p>
</li>
<li>
<p><code>mySettings.dropdowns</code> - add your dropdown settings here</p>
</li>
<li>
<p><code>globalSettings</code> - the right column of the settings dropdown ("Global view")</p>
</li>
<li>
<p><code>importColumn</code> - import form</p>
</li>
<li>
<p><code>exportColumn</code> - export form</p>
</li>
<li>
<p><code>modals</code> - Contains all connectivity messages</p>
</li>
<li>
<p><code>embedPopup</code> - the embed dropdown</p>
</li>
<li>
<p><code>scripts</code> - Add your script tags here, if you really have to (consider use client-side hooks instead)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>timeslider.html</code> blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>timesliderStyles</code></p>
</li>
<li>
<p><code>timesliderScripts</code></p>
</li>
<li>
<p><code>timesliderBody</code></p>
</li>
<li>
<p><code>timesliderTop</code></p>
</li>
<li>
<p><code>timesliderEditbarRight</code></p>
</li>
<li>
<p><code>modals</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>index.html</code> blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>indexCustomStyles</code> - contains the <code>index.css</code> <code>&lt;link&gt;</code> tag, allows you to add your own or to customize the one provided by the active skin</p>
</li>
<li>
<p><code>indexWrapper</code> - contains the form for creating new pads</p>
</li>
<li>
<p><code>indexCustomScripts</code> - contains the <code>index.js</code> <code>&lt;script&gt;</code> tag, allows you to add your own or to customize the one provided by the active skin</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_padinittoolbar">padInitToolbar</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/specialpages.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>toolbar - the toolbar controller that will render the toolbar eventually</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here you can add custom toolbar items that will be available in the toolbar config in <code>settings.json</code>. For more about the toolbar controller see the API section.</p>
</div>
<div class="paragraph">
<p>Usage examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/tiblu/ep_authorship_toggle" class="bare">https://github.com/tiblu/ep_authorship_toggle</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_onaccesscheck">onAccessCheck</h3>
<div class="paragraph">
<p>Called from: src/node/db/SecurityManager.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>padID - the real ID (never the read-only ID) of the pad the user wants to
access</p>
</li>
<li>
<p>token - the token of the author</p>
</li>
<li>
<p>sessionCookie - the session the use has</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook gets called when the access to the concrete pad is being checked.
Return <code>false</code> to deny access.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getauthorid">getAuthorId</h3>
<div class="paragraph">
<p>Called from <code>src/node/db/AuthorManager.js</code></p>
</div>
<div class="paragraph">
<p>Called when looking up (or creating) the author ID for a user, except for author
IDs obtained via the HTTP API. Registered hook functions are called until one
returns a non-<code>undefined</code> value. If a truthy value is returned by a hook
function, it is used as the user&#8217;s author ID. Otherwise, the value of the
<code>dbKey</code> context property is used to look up the author ID. If there is no such
author ID at that key, a new author ID is generated and associated with that
key.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dbKey</code>: Database key to use when looking up the user&#8217;s author ID if no hook
function returns an author ID. This is initialized to the user-supplied token
value (see the <code>token</code> context property), but hook functions can modify this
to control how author IDs are allocated to users. If no author ID is
associated with this database key, a new author ID will be randomly generated
and associated with the key. For security reasons, if this is modified it
should be modified to not look like a valid token (see the <code>token</code> context
property) unless the plugin intentionally wants the user to be able to
impersonate another user.</p>
</li>
<li>
<p><code>token</code>: The user-supplied token, or nullish for an anonymous user. Tokens are
secret values that must not be disclosed to others. If non-null, the token is
guaranteed to be a string with the form <code>t.&lt;base64url&gt;</code> where <code>&lt;base64url&gt;</code> is
any valid non-empty base64url string (RFC 4648 section 5 with padding).
Example: <code>t.twim3X2_KGiRj8cJ-3602g==</code>.</p>
</li>
<li>
<p><code>user</code>: If the user has authenticated, this is an object from <code>settings.users</code>
(or similar from an authentication plugin). Etherpad core and all good
authentication plugins set the <code>username</code> property of this object to a string
that uniquely identifies the authenticated user. This object is nullish if the
user has not authenticated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.getAuthorId = async (hookName, context) =&gt; {
  const {username} = context.user || {};
  // If the user has not authenticated, or has "authenticated" as the guest
  // user, do the default behavior (try another plugin if any, falling through
  // to using the token as the database key).
  if (!username || username === 'guest') return;
  // The user is authenticated and has a username. Give the user a stable author
  // ID so that they appear to be the same author even after clearing cookies or
  // accessing the pad from another device. Note that this string is guaranteed
  // to never have the form of a valid token; without that guarantee an
  // unauthenticated user might be able to impersonate an authenticated user.
  context.dbKey = `username=${username}`;
  // Return a falsy but non-undefined value to stop Etherpad from calling any
  // more getAuthorId hook functions and look up the author ID using the
  // username-derived database key.
  return '';
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_padcreate">padCreate</h3>
<div class="paragraph">
<p>Called from: <code>src/node/db/Pad.js</code></p>
</div>
<div class="paragraph">
<p>Called when a new pad is created.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: The Pad object.</p>
</li>
<li>
<p><code>authorId</code>: The ID of the author who created the pad.</p>
</li>
<li>
<p><code>author</code> (<strong>deprecated</strong>): Synonym of <code>authorId</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_paddefaultcontent">padDefaultContent</h3>
<div class="paragraph">
<p>Called from <code>src/node/db/Pad.js</code></p>
</div>
<div class="paragraph">
<p>Called to obtain a pad&#8217;s initial content, unless the pad is being created with
specific content. The return value is ignored; to change the content, modify the
<code>content</code> context property.</p>
</div>
<div class="paragraph">
<p>This hook is run asynchronously. All registered hook functions are run
concurrently (via <code>Promise.all()</code>), so be careful to avoid race conditions when
reading and modifying the context properties.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: The newly created Pad object.</p>
</li>
<li>
<p><code>authorId</code>: The author ID of the user that is creating the pad.</p>
</li>
<li>
<p><code>type</code>: String identifying the content type. Currently this is <code>'text'</code> and
must not be changed. Future versions of Etherpad may add support for HTML,
jsdom objects, or other formats, so plugins must assert that this matches a
supported content type before reading <code>content</code>.</p>
</li>
<li>
<p><code>content</code>: The pad&#8217;s initial content. Change this property to change the pad&#8217;s
initial content. If the content type is changed, the <code>type</code> property must also
be updated to match. Plugins must check the value of the <code>type</code> property
before reading this value.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_padload">padLoad</h3>
<div class="paragraph">
<p>Called from: <code>src/node/db/PadManager.js</code></p>
</div>
<div class="paragraph">
<p>Called when a pad is loaded, including after new pad creation.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: The Pad object.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_padupdate">padUpdate</h3>
<div class="paragraph">
<p>Called from: <code>src/node/db/Pad.js</code></p>
</div>
<div class="paragraph">
<p>Called when an existing pad is updated.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: The Pad object.</p>
</li>
<li>
<p><code>authorId</code>: The ID of the author who updated the pad.</p>
</li>
<li>
<p><code>author</code> (<strong>deprecated</strong>): Synonym of <code>authorId</code>.</p>
</li>
<li>
<p><code>revs</code>: The index of the new revision.</p>
</li>
<li>
<p><code>changeset</code>: The changeset of this revision (see <a href="#_padupdate">padUpdate</a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_padcopy">padCopy</h3>
<div class="paragraph">
<p>Called from: <code>src/node/db/Pad.js</code></p>
</div>
<div class="paragraph">
<p>Called when a pad is copied so that plugins can copy plugin-specific database
records or perform some other plugin-specific initialization.</p>
</div>
<div class="paragraph">
<p>Order of events when a pad is copied:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Destination pad is deleted if it exists and overwrite is permitted. This
causes the <code>padRemove</code> hook to run.</p>
</li>
<li>
<p>Pad-specific database records are copied in the database, except for
records with plugin-specific database keys.</p>
</li>
<li>
<p>A new Pad object is created for the destination pad. This causes the
<code>padLoad</code> hook to run.</p>
</li>
<li>
<p>This hook runs.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srcPad</code>: The source Pad object.</p>
</li>
<li>
<p><code>dstPad</code>: The destination Pad object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Usage examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/ether/ep_comments_page" class="bare">https://github.com/ether/ep_comments_page</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_padremove">padRemove</h3>
<div class="paragraph">
<p>Called from: <code>src/node/db/Pad.js</code></p>
</div>
<div class="paragraph">
<p>Called when an existing pad is removed/deleted. Plugins should use this to clean
up any plugin-specific pad records from the database.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: Pad object for the pad that is being deleted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Usage examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/ether/ep_comments_page" class="bare">https://github.com/ether/ep_comments_page</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_padcheck">padCheck</h3>
<div class="paragraph">
<p>Called from: <code>src/node/db/Pad.js</code></p>
</div>
<div class="paragraph">
<p>Called when a consistency check is run on a pad, after the core checks have
completed successfully. An exception should be thrown if the pad is faulty in
some way.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: The Pad object that is being checked.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_socketio">socketio</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/socketio.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>app - the application object</p>
</li>
<li>
<p>io - the socketio object</p>
</li>
<li>
<p>server - the http server object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>I have no idea what this is useful for, someone else will have to add this description.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preauthorize">preAuthorize</h3>
<div class="paragraph">
<p>Called from: <code>src/node/hooks/express/webaccess.js</code></p>
</div>
<div class="paragraph">
<p>Called for each HTTP request before any authentication checks are performed. The
registered <code>preAuthorize</code> hook functions are called one at a time until one
explicitly grants or denies the request by returning <code>true</code> or <code>false</code>,
respectively. If none of the hook functions return anything, the access decision
is deferred to the normal authentication and authorization checks.</p>
</div>
<div class="paragraph">
<p>Example uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always grant access to static content.</p>
</li>
<li>
<p>Process an OAuth callback.</p>
</li>
<li>
<p>Drop requests from IP addresses that have failed N authentication checks
within the past X minutes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Return values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>undefined</code> (or <code>[]</code>) defers the access decision to the next registered
<code>preAuthorize</code> hook function, or to the normal authentication and
authorization checks if no more <code>preAuthorize</code> hook functions remain.</p>
</li>
<li>
<p><code>true</code> (or <code>[true]</code>) immediately grants access to the requested resource,
unless the request is for an <code>/admin</code> page in which case it is treated the
same as returning <code>undefined</code>. (This prevents buggy plugins from accidentally
granting admin access to the general public.)</p>
</li>
<li>
<p><code>false</code> (or <code>[false]</code>) immediately denies the request. The <code>preAuthnFailure</code>
hook will be called to handle the failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>req</code>: The Express <a href="https://expressjs.com/en/4x/api.html==req">Request</a> object.</p>
</li>
<li>
<p><code>res</code>: The Express <a href="https://expressjs.com/en/4x/api.html==res">Response</a>
object.</p>
</li>
<li>
<p><code>next</code>: Callback to immediately hand off handling to the next Express
middleware/handler, or to the next matching route if <code>'route'</code> is passed as
the first argument. Do not call this unless you understand the consequences.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.preAuthorize = async (hookName, {req}) =&gt; {
  if (await ipAddressIsFirewalled(req)) return false;
  if (requestIsForStaticContent(req)) return true;
  if (requestIsForOAuthCallback(req)) return true;
  // Defer the decision to the next step by returning undefined.
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authorize">authorize</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/webaccess.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>req - the request object</p>
</li>
<li>
<p>res - the response object</p>
</li>
<li>
<p>next - ?</p>
</li>
<li>
<p>resource - the path being accessed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook is called to handle authorization. It is especially useful for
controlling access to specific paths.</p>
</div>
<div class="paragraph">
<p>A plugin&#8217;s authorize function is only called if all of the following are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The request is not for static content or an API endpoint. (Requests for static
content and API endpoints are always authorized, even if unauthenticated.)</p>
</li>
<li>
<p>The <code>requireAuthentication</code> and <code>requireAuthorization</code> settings are both true.</p>
</li>
<li>
<p>The user has already successfully authenticated.</p>
</li>
<li>
<p>The user is not an admin (admin users are always authorized).</p>
</li>
<li>
<p>The path being accessed is not an <code>/admin</code> path (<code>/admin</code> paths can only be
accessed by admin users, and admin users are always authorized).</p>
</li>
<li>
<p>An authorize function from a different plugin has not already caused
authorization to pass or fail.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the authorize hook cannot grant access to <code>/admin</code> pages. If admin
access is desired, the <code>is_admin</code> user setting must be set to true. This can be
set in the settings file or by the authenticate hook.</p>
</div>
<div class="paragraph">
<p>You can pass the following values to the provided callback:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[true]</code> or <code>['create']</code> will grant access to modify or create the pad if the
request is for a pad, otherwise access is simply granted. Access to a pad will
be downgraded to modify-only if <code>settings.editOnly</code> is true or the user&#8217;s
<code>canCreate</code> setting is set to <code>false</code>, and downgraded to read-only if the
user&#8217;s <code>readOnly</code> setting is <code>true</code>.</p>
</li>
<li>
<p><code>['modify']</code> will grant access to modify but not create the pad if the request
is for a pad, otherwise access is simply granted. Access to a pad will be
downgraded to read-only if the user&#8217;s <code>readOnly</code> setting is <code>true</code>.</p>
</li>
<li>
<p><code>['readOnly']</code> will grant read-only access.</p>
</li>
<li>
<p><code>[false]</code> will deny access.</p>
</li>
<li>
<p><code>[]</code> or <code>undefined</code> will defer the authorization decision to the next
authorization plugin (if any, otherwise deny).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.authorize = (hookName, context, cb) =&gt; {
  const user = context.req.session.user;
  const path = context.req.path;  // or context.resource
  if (isExplicitlyProhibited(user, path)) return cb([false]);
  if (isExplicitlyAllowed(user, path)) return cb([true]);
  return cb([]);  // Let the next authorization plugin decide
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authenticate">authenticate</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/webaccess.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>req - the request object</p>
</li>
<li>
<p>res - the response object</p>
</li>
<li>
<p>users - the users object from settings.json (possibly modified by plugins)</p>
</li>
<li>
<p>next - ?</p>
</li>
<li>
<p>username - the username used (optional)</p>
</li>
<li>
<p>password - the password used (optional)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook is called to handle authentication.</p>
</div>
<div class="paragraph">
<p>Plugins that supply an authenticate function should probably also supply an
authnFailure function unless falling back to HTTP basic authentication is
appropriate upon authentication failure.</p>
</div>
<div class="paragraph">
<p>This hook is only called if either the <code>requireAuthentication</code> setting is true
or the request is for an <code>/admin</code> page.</p>
</div>
<div class="paragraph">
<p>Calling the provided callback with <code>[true]</code> or <code>[false]</code> will cause
authentication to succeed or fail, respectively. Calling the callback with <code>[]</code>
or <code>undefined</code> will defer the authentication decision to the next authentication
plugin (if any, otherwise fall back to HTTP basic authentication).</p>
</div>
<div class="paragraph">
<p>If you wish to provide a mix of restricted and anonymous access (e.g., some pads
are private, others are public), you can "authenticate" (as a guest account)
users that have not yet logged in, and rely on other hooks (e.g., authorize,
onAccessCheck, handleMessageSecurity) to authorize specific privileged actions.</p>
</div>
<div class="paragraph">
<p>If authentication is successful, the authenticate function MUST set
<code>context.req.session.user</code> to the user&#8217;s settings object. The <code>username</code>
property of this object should be set to the user&#8217;s username. The settings
object should come from global settings (<code>context.users[username]</code>).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.authenticate = (hook_name, context, cb) =&gt; {
  if (notApplicableToThisPlugin(context)) {
    return cb([]);  // Let the next authentication plugin decide
  }
  const username = authenticate(context);
  if (!username) {
    console.warn(`ep_myplugin.authenticate: Failed authentication from IP ${context.req.ip}`);
    return cb([false]);
  }
  console.info(`ep_myplugin.authenticate: Successful authentication from IP ${context.req.ip} for user ${username}`);
  const users = context.users;
  if (!(username in users)) users[username] = {};
  users[username].username = username;
  context.req.session.user = users[username];
  return cb([true]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authfailure">authFailure</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/webaccess.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>req - the request object</p>
</li>
<li>
<p>res - the response object</p>
</li>
<li>
<p>next - ?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>DEPRECATED:</strong> Use authnFailure or authzFailure instead.</p>
</div>
<div class="paragraph">
<p>This hook is called to handle an authentication or authorization failure.</p>
</div>
<div class="paragraph">
<p>Plugins that supply an authenticate function should probably also supply an
authnFailure function unless falling back to HTTP basic authentication is
appropriate upon authentication failure.</p>
</div>
<div class="paragraph">
<p>A plugin&#8217;s authFailure function is only called if all of the following are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There was an authentication or authorization failure.</p>
</li>
<li>
<p>The failure was not already handled by an authFailure function from another
plugin.</p>
</li>
<li>
<p>For authentication failures: The failure was not already handled by the
authnFailure hook.</p>
</li>
<li>
<p>For authorization failures: The failure was not already handled by the
authzFailure hook.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calling the provided callback with <code>[true]</code> tells Etherpad that the failure was
handled and no further error handling is required. Calling the callback with
<code>[]</code> or <code>undefined</code> defers error handling to the next authFailure plugin (if
any, otherwise fall back to HTTP basic authentication for an authentication
failure or a generic 403 page for an authorization failure).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.authFailure = (hookName, context, cb) =&gt; {
  if (notApplicableToThisPlugin(context)) {
    return cb([]);  // Let the next plugin handle the error
  }
  context.res.redirect(makeLoginURL(context.req));
  return cb([true]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_preauthzfailure">preAuthzFailure</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/webaccess.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>req - the request object</p>
</li>
<li>
<p>res - the response object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook is called to handle a pre-authentication authorization failure.</p>
</div>
<div class="paragraph">
<p>A plugin&#8217;s preAuthzFailure function is only called if the pre-authentication
authorization failure was not already handled by a preAuthzFailure function from
another plugin.</p>
</div>
<div class="paragraph">
<p>Calling the provided callback with <code>[true]</code> tells Etherpad that the failure was
handled and no further error handling is required. Calling the callback with
<code>[]</code> or <code>undefined</code> defers error handling to a preAuthzFailure function from
another plugin (if any, otherwise fall back to a generic 403 error page).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.preAuthzFailure = (hookName, context, cb) =&gt; {
  if (notApplicableToThisPlugin(context)) return cb([]);
  context.res.status(403).send(renderFancy403Page(context.req));
  return cb([true]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authnfailure">authnFailure</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/webaccess.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>req - the request object</p>
</li>
<li>
<p>res - the response object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook is called to handle an authentication failure.</p>
</div>
<div class="paragraph">
<p>Plugins that supply an authenticate function should probably also supply an
authnFailure function unless falling back to HTTP basic authentication is
appropriate upon authentication failure.</p>
</div>
<div class="paragraph">
<p>A plugin&#8217;s authnFailure function is only called if the authentication failure
was not already handled by an authnFailure function from another plugin.</p>
</div>
<div class="paragraph">
<p>Calling the provided callback with <code>[true]</code> tells Etherpad that the failure was
handled and no further error handling is required. Calling the callback with
<code>[]</code> or <code>undefined</code> defers error handling to an authnFailure function from
another plugin (if any, otherwise fall back to the deprecated authFailure hook).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.authnFailure = (hookName, context, cb) =&gt; {
  if (notApplicableToThisPlugin(context)) return cb([]);
  context.res.redirect(makeLoginURL(context.req));
  return cb([true]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authzfailure">authzFailure</h3>
<div class="paragraph">
<p>Called from: src/node/hooks/express/webaccess.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>req - the request object</p>
</li>
<li>
<p>res - the response object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook is called to handle a post-authentication authorization failure.</p>
</div>
<div class="paragraph">
<p>A plugin&#8217;s authzFailure function is only called if the authorization failure was
not already handled by an authzFailure function from another plugin.</p>
</div>
<div class="paragraph">
<p>Calling the provided callback with <code>[true]</code> tells Etherpad that the failure was
handled and no further error handling is required. Calling the callback with
<code>[]</code> or <code>undefined</code> defers error handling to an authzFailure function from
another plugin (if any, otherwise fall back to the deprecated authFailure hook).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.authzFailure = (hookName, context, cb) =&gt; {
  if (notApplicableToThisPlugin(context)) return cb([]);
  if (needsPremiumAccount(context.req) &amp;&amp; !context.req.session.user.premium) {
    context.res.status(200).send(makeUpgradeToPremiumAccountPage(context.req));
    return cb([true]);
  }
  // Use the generic 403 forbidden response.
  return cb([]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handlemessage">handleMessage</h3>
<div class="paragraph">
<p>Called from: <code>src/node/handler/PadMessageHandler.js</code></p>
</div>
<div class="paragraph">
<p>This hook allows plugins to drop or modify incoming socket.io messages from
clients, before Etherpad processes them. If any hook function returns <code>null</code>
then the message will not be subject to further processing.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message</code>: The message being handled.</p>
</li>
<li>
<p><code>sessionInfo</code>: Object describing the socket.io session with the following
properties:</p>
</li>
<li>
<p><code>authorId</code>: The user&#8217;s author ID.</p>
</li>
<li>
<p><code>padId</code>: The real (not read-only) ID of the pad.</p>
</li>
<li>
<p><code>readOnly</code>: Whether the client has read-only access (true) or read/write
access (false).</p>
</li>
<li>
<p><code>socket</code>: The socket.io Socket object.</p>
</li>
<li>
<p><code>client</code>: (<strong>Deprecated</strong>; use <code>socket</code> instead.) Synonym of <code>socket</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.handleMessage = async (hookName, {message, socket}) =&gt; {
  if (message.type === 'USERINFO_UPDATE') {
    // Force the display name to the name associated with the account.
    const user = socket.client.request.session.user || {};
    if (user.name) message.data.userInfo.name = user.name;
  }
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handlemessagesecurity">handleMessageSecurity</h3>
<div class="paragraph">
<p>Called from: <code>src/node/handler/PadMessageHandler.js</code></p>
</div>
<div class="paragraph">
<p>Called for each incoming message from a client. Allows plugins to grant
temporary write access to a pad.</p>
</div>
<div class="paragraph">
<p>Supported return values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>undefined</code>: No change in access status.</p>
</li>
<li>
<p><code>'permitOnce'</code>: Override the user&#8217;s read-only access for the current
<code>COLLABROOM</code> message only. Has no effect if the current message is not a
<code>COLLABROOM</code> message, or if the user already has write access to the pad.</p>
</li>
<li>
<p><code>true</code>: (<strong>Deprecated</strong>; return <code>'permitOnce'</code> instead.) Override the user&#8217;s
read-only access for all <code>COLLABROOM</code> messages from the same socket.io
connection (including the current message, if applicable) until the client&#8217;s
next <code>CLIENT_READY</code> message. Has no effect if the user already has write
access to the pad. Read-only access is reset <strong>after</strong> each <code>CLIENT_READY</code>
message, so returning <code>true</code> has no effect for <code>CLIENT_READY</code> messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message</code>: The message being handled.</p>
</li>
<li>
<p><code>sessionInfo</code>: Object describing the socket.io connection with the following
properties:</p>
</li>
<li>
<p><code>authorId</code>: The user&#8217;s author ID.</p>
</li>
<li>
<p><code>padId</code>: The real (not read-only) ID of the pad.</p>
</li>
<li>
<p><code>readOnly</code>: Whether the client has read-only access (true) or read/write
access (false).</p>
</li>
<li>
<p><code>socket</code>: The socket.io Socket object.</p>
</li>
<li>
<p><code>client</code>: (<strong>Deprecated</strong>; use <code>socket</code> instead.) Synonym of <code>socket</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.handleMessageSecurity = async (hookName, context) =&gt; {
  const {message, sessionInfo: {readOnly}} = context;
  if (!readOnly || message.type !== 'COLLABROOM') return;
  if (await messageIsBenign(message)) return 'permitOnce';
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clientvars">clientVars</h3>
<div class="paragraph">
<p>Called from: src/node/handler/PadMessageHandler.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>clientVars - the basic <code>clientVars</code> built by the core</p>
</li>
<li>
<p>pad - the pad this session is about</p>
</li>
<li>
<p>socket - the socket.io Socket object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook is called after a client connects but before the initial configuration
is sent to the client. Plugins can use this hook to manipulate the
configuration. (Example: Add a tracking ID for an external analytics tool that
is used client-side.)</p>
</div>
<div class="paragraph">
<p>You can manipulate <code>clientVars</code> in two different ways:
* Return an object. The object will be merged into <code>clientVars</code> via
  <code>Object.assign()</code>, so any keys that already exist in <code>clientVars</code> will be
  overwritten by the values in the returned object.
* Modify <code>context.clientVars</code>. Beware: Other plugins might also be reading or
  manipulating the same <code>context.clientVars</code> object. To avoid race conditions,
  you are encouraged to return an object rather than modify
  <code>context.clientVars</code>.</p>
</div>
<div class="paragraph">
<p>If needed, you can access the user&#8217;s account information (if authenticated) via
<code>context.socket.client.request.session.user</code>.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Using an async function
exports.clientVars = async (hookName, context) =&gt; {
  const user = context.socket.client.request.session.user || {};
  return {'accountUsername': user.username || '&lt;unknown&gt;'}
};

// Using a regular function
exports.clientVars = (hookName, context, callback) =&gt; {
  const user = context.socket.client.request.session.user || {};
  return callback({'accountUsername': user.username || '&lt;unknown&gt;'});
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getlinehtmlforexport">getLineHTMLForExport</h3>
<div class="paragraph">
<p>Called from: <code>src/node/utils/ExportHtml.js</code></p>
</div>
<div class="paragraph">
<p>This hook will allow a plug-in developer to re-write each line when exporting to
HTML.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apool</code>: Pool object.</p>
</li>
<li>
<p><code>attribLine</code>: Line attributes.</p>
</li>
<li>
<p><code>line</code>:</p>
</li>
<li>
<p><code>lineContent</code>:</p>
</li>
<li>
<p><code>text</code>: Line text.</p>
</li>
<li>
<p><code>padId</code>: Writable (not read-only) pad identifier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const AttributeMap = require('ep_etherpad-lite/static/js/AttributeMap');
const Changeset = require('ep_etherpad-lite/static/js/Changeset');

exports.getLineHTMLForExport = async (hookName, context) =&gt; {
  if (!context.attribLine) return;
  const [op] = Changeset.deserializeOps(context.attribLine);
  if (op == null) return;
  const heading = AttributeMap.fromString(op.attribs, context.apool).get('heading');
  if (!heading) return;
  context.lineContent = `&lt;${heading}&gt;${context.lineContent}&lt;/${heading}&gt;`;
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporthtmladditionalcontent">exportHTMLAdditionalContent</h3>
<div class="paragraph">
<p>Called from: src/node/utils/ExportHtml.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>padId</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook will allow a plug-in developer to include additional HTML content in
the body of the exported HTML.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.exportHTMLAdditionalContent = async (hookName, {padId}) =&gt; {
  return 'I am groot in ' + padId;
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stylesforexport">stylesForExport</h3>
<div class="paragraph">
<p>Called from: src/node/utils/ExportHtml.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>padId - The Pad Id</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook will allow a plug-in developer to append Styles to the Exported HTML.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.stylesForExport = function(hook, padId, cb){
  cb("body{font-size:13.37em !important}");
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aceattribclasses">aceAttribClasses</h3>
<div class="paragraph">
<p>Called from: src/static/js/linestylefilter.js</p>
</div>
<div class="paragraph">
<p>This hook is called when attributes are investigated on a line. It is useful if
you want to add another attribute type or property type to a pad.</p>
</div>
<div class="paragraph">
<p>An attributes object is passed to the aceAttribClasses hook functions instead of
the usual context object. A hook function can either modify this object directly
or provide an object whose properties will be assigned to the attributes object.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.aceAttribClasses = (hookName, attrs, cb) =&gt; {
  return cb([{
    sub: 'tag:sub',
  }]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exportfilename">exportFileName</h3>
<div class="paragraph">
<p>Called from src/node/handler/ExportHandler.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>padId</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook will allow a plug-in developer to modify the file name of an exported pad.  This is useful if you want to export a pad under another name and/or hide the padId under export.  Note that the doctype or file extension cannot be modified for security reasons.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.exportFileName = function(hook, padId, callback){
  callback("newFileName"+padId);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporthtmladditionaltags">exportHtmlAdditionalTags</h3>
<div class="paragraph">
<p>Called from src/node/utils/ExportHtml.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pad object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hook will allow a plug-in developer to include more properties and attributes to support during HTML Export. If tags are stored as <code>['color', 'red']</code> on the attribute pool, use <code>exportHtmlAdditionalTagsWithData</code> instead. An Array should be returned.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Add the props to be supported in export
exports.exportHtmlAdditionalTags = function(hook, pad, cb){
  var padId = pad.id;
  cb(["massive","jugs"]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporthtmladditionaltagswithdata">exportHtmlAdditionalTagsWithData</h3>
<div class="paragraph">
<p>Called from src/node/utils/ExportHtml.js</p>
</div>
<div class="paragraph">
<p>Things in context:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pad object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Identical to <code>exportHtmlAdditionalTags</code>, but for tags that are stored with a specific value (not simply <code>true</code>) on the attribute pool. For example <code>['color', 'red']</code>, instead of <code>['bold', true]</code>. This hook will allow a plug-in developer to include more properties and attributes to support during HTML Export. An Array of arrays should be returned. The exported HTML will contain tags like <code>&lt;span data-color="red"&gt;</code> for the content where attributes are <code>['color', 'red']</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Add the props to be supported in export
exports.exportHtmlAdditionalTagsWithData = function(hook, pad, cb){
  var padId = pad.id;
  cb([["color", "red"], ["color", "blue"]]);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exportetherpadadditionalcontent">exportEtherpadAdditionalContent</h3>
<div class="paragraph">
<p>Called from <code>src/node/utils/ExportEtherpad.js</code> and
<code>src/node/utils/ImportEtherpad.js</code>.</p>
</div>
<div class="paragraph">
<p>Called when exporting to an <code>.etherpad</code> file or when importing from an
<code>.etherpad</code> file. The hook function should return prefixes for pad-specific
records that should be included in the export/import. On export, all
<code>${prefix}:${padId}</code> and <code>${prefix}:${padId}:*</code> records are included in the
generated <code>.etherpad</code> file. On import, all <code>${prefix}:${padId}</code> and
<code>${prefix}:${padId}:*</code> records are loaded into the database.</p>
</div>
<div class="paragraph">
<p>Context properties: None.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Add support for exporting comments metadata
exports.exportEtherpadAdditionalContent = () =&gt; ['comments'];</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exportetherpad">exportEtherpad</h3>
<div class="paragraph">
<p>Called from <code>src/node/utils/ExportEtherpad.js</code>.</p>
</div>
<div class="paragraph">
<p>Called when exporting to an <code>.etherpad</code> file.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: The exported pad&#8217;s Pad object.</p>
</li>
<li>
<p><code>data</code>: JSONable output object. This is pre-populated with records from core
Etherpad as well as pad-specific records with prefixes from the
<code>exportEtherpadAdditionalContent</code> hook. Registered hook functions can modify
this object (but not replace the object) to perform any desired
transformations to the exported data (such as the inclusion of
plugin-specific records). All registered hook functions are executed
concurrently, so care should be taken to avoid race conditions with other
plugins.</p>
</li>
<li>
<p><code>dstPadId</code>: The pad ID that should be used when writing pad-specific records
to <code>data</code> (instead of <code>pad.id</code>). This avoids leaking the writable pad ID
when a user exports a read-only pad. This might be a dummy value; plugins
should not assume that it is either the pad&#8217;s real writable ID or its
read-only ID.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_importetherpad">importEtherpad</h3>
<div class="paragraph">
<p>Called from <code>src/node/utils/ImportEtherpad.js</code>.</p>
</div>
<div class="paragraph">
<p>Called when importing from an <code>.etherpad</code> file.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pad</code>: Temporary Pad object containing the pad&#8217;s data read from the imported
<code>.etherpad</code> file. The <code>pad.db</code> object is a temporary in-memory database
whose records will be copied to the real database after they are validated
(see the <code>padCheck</code> hook). Registered hook functions MUST NOT use the real
database to access (read or write) pad-specific records; they MUST instead
use <code>pad.db</code>. All registered hook functions are executed concurrently, so
care should be taken to avoid race conditions with other plugins.</p>
</li>
<li>
<p><code>data</code>: Raw JSONable object from the <code>.etherpad</code> file. This data must not be
modified.</p>
</li>
<li>
<p><code>srcPadId</code>: The pad ID used for the pad-specific information in <code>data</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_import">import</h3>
<div class="paragraph">
<p>Called from: <code>src/node/handler/ImportHandler.js</code></p>
</div>
<div class="paragraph">
<p>Called when a user submits a document for import, before the document is
converted to HTML. The hook function should return a truthy value if the hook
function elected to convert the document to HTML.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>destFile</code>: The destination HTML filename.</p>
</li>
<li>
<p><code>fileEnding</code>: The lower-cased filename extension from <code>srcFile</code> <strong>with leading
period</strong> (examples: <code>'.docx'</code>, <code>'.html'</code>, <code>'.etherpad'</code>).</p>
</li>
<li>
<p><code>padId</code>: The identifier of the destination pad.</p>
</li>
<li>
<p><code>srcFile</code>: The document to convert.</p>
</li>
<li>
<p><code>ImportError</code>: Subclass of Error that can be thrown to provide a specific
error message to the user. The constructor&#8217;s first argument must be a string
matching one of the <a href="https://github.com/ether/etherpad-lite/blob/1.9.6/src/static/js/pad_impexp.js#L80-L86">known error identifiers</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.import = async (hookName, {fileEnding, ImportError}) =&gt; {
  // Reject all *.etherpad imports with a permission denied message.
  if (fileEnding === '.etherpad') throw new ImportError('permission');
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_userjoin">userJoin</h3>
<div class="paragraph">
<p>Called from: <code>src/node/handler/PadMessageHandler.js</code></p>
</div>
<div class="paragraph">
<p>Called after users have been notified that a new user has joined the pad.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authorId</code>: The user&#8217;s author identifier.</p>
</li>
<li>
<p><code>displayName</code>: The user&#8217;s display name.</p>
</li>
<li>
<p><code>padId</code>: The real (not read-only) identifier of the pad the user joined. This
MUST NOT be shared with any users that are connected with read-only access.</p>
</li>
<li>
<p><code>readOnly</code>: Whether the user only has read-only access.</p>
</li>
<li>
<p><code>readOnlyPadId</code>: The read-only identifier of the pad the user joined.</p>
</li>
<li>
<p><code>socket</code>: The socket.io Socket object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.userJoin = async (hookName, {authorId, displayName, padId}) =&gt; {
  console.log(`${authorId} (${displayName}) joined pad ${padId});
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_userleave">userLeave</h3>
<div class="paragraph">
<p>Called from: <code>src/node/handler/PadMessageHandler.js</code></p>
</div>
<div class="paragraph">
<p>Called when a user disconnects from a pad. This is useful if you want to perform
certain actions after a pad has been edited.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authorId</code>: The user&#8217;s author ID.</p>
</li>
<li>
<p><code>padId</code>: The pad&#8217;s real (not read-only) identifier.</p>
</li>
<li>
<p><code>readOnly</code>: If truthy, the user only has read-only access.</p>
</li>
<li>
<p><code>readOnlyPadId</code>: The pad&#8217;s read-only identifier.</p>
</li>
<li>
<p><code>socket</code>: The socket.io Socket object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.userLeave = async (hookName, {author, padId}) =&gt; {
  console.log(`${author} left pad ${padId}`);
};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_chatnewmessage">chatNewMessage</h3>
<div class="paragraph">
<p>Called from: <code>src/node/handler/PadMessageHandler.js</code></p>
</div>
<div class="paragraph">
<p>Called when a user (or plugin) generates a new chat message, just before it is
saved to the pad and relayed to all connected users.</p>
</div>
<div class="paragraph">
<p>Context properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message</code>: The chat message object. Plugins can mutate this object to change
the message text or add custom metadata to control how the message will be
rendered by the <code>chatNewMessage</code> client-side hook. The message&#8217;s <code>authorId</code>
property can be trusted (the server overwrites any client-provided author ID
value with the user&#8217;s actual author ID before this hook runs).</p>
</li>
<li>
<p><code>padId</code>: The pad&#8217;s real (not read-only) identifier.</p>
</li>
<li>
<p><code>pad</code>: The pad&#8217;s Pad object.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-12-28 17:23:02 UTC
</div>
</div>
</body>
</html>